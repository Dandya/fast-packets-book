# Основы работы сетевого стека ядра Linux

***

В данном разделе разбирается устройство сетевого стека ядра Linux от сетевой карты до сокетов.

1. [Драйвер сетевой карты](#драйвер-сетевой-карты)
	 1. [Получение сетевых пакетов](#получение-сетевых-пакетов)
	 2. [Отправка сетевых пакетов](#отправка-сетевых-пакетов)
2. [Сокеты ядра Linux](#сокеты-ядра-linux)
3. [Полезные материалы](#полезные-материалы)
4. [Источники](#источники)

***

## Драйвер сетевой карты

Устройство NIC (Network interface controller) или сетевая карта — это аппаратный компонент, который устанавливается в компьютер или сервер для подключения к локальной сети (LAN) [1]. В эталонной модели OSI сетевая карта отвечает не только за работу физического уровня, определяя способ передачи сетевых пакетов, но и за канальный уровень, управляя получаемыми и отправляемыми кадрами. Для этого устройство выполняет следующие функции:

1. формирование кадров и проверка хеш-сумм;
2. запись кадров в оперативную память;
3. фильтрация трафика по адресам;
4. генерация прерываний;
5. аппаратное ускорение обработки пакетов.

Для управления сетевой картой и обеспечением доступа к передаваемым пакетам используется драйвер сетевой карты. Его реализация зависит от используемой операционной системы, но его выполняемые функции остаются общими:

1. инициализация сетевой карты и управление её параметрами;
2. регистрация устройства в ядре операционной системе;
3. обработка прерываний;
4. запись и чтение кадров.

Ядро Linux является монолитным с поддержкой модулей ядра [2]. Модули ядра могут выполнять различные функции от реализации драйверов (модуль «IGB» [3]) и файловых систем (модуль «BTRFS» [4]) до виртуализации (модуль «KVM» [5]), поэтому далее понятия модуля ядра и драйвера будут одним и тем же. Дальнейшее описание работы драйверов сетевых карт будет основано на реализаци модуля «IGB», так как его работу можно эмулировать в системе виртуализации «QEMU» (см. [создание песочницы](Sandbox-qemu.md)).

### Получение сетевых пакетов

(https://blog.packagecloud.io/monitoring-tuning-linux-networking-stack-receiving-data/)
(https://habr.com/ru/companies/vk/articles/314168/)

### Отправка сетевых пакетов

(https://blog.packagecloud.io/monitoring-tuning-linux-networking-stack-sending-data/)

## Сокеты ядра Linux

(https://man7.org/linux/man-pages/man7/socket.7.html)

## Полезные материалы

1. Иностранный стандарт ISO/IEC 7498 или ГОСТ Р ИСО/МЭК 7498-1-99.

## Источники

1. https://www.gartner.com/en/information-technology/glossary/nic-network-interface-card
2. Цилюрик О. И. Расширения ядра Linux: драйверы и модули. — СПб.: БХВ-Петербург, 688 с.: ил. ISBN 978-5-9775-1719-5
3. https://www.kernel.org/doc/html/latest/networking/device_drivers/ethernet/intel/igb.html
4. https://www.kernel.org/doc/html/latest/filesystems/btrfs.html
5. https://www.kernel.org/doc/html/latest/virt/kvm/api.html

